%% Main Program

clc;
clear all;
close all;

%load data 
load all_image_data.mat
%Read labels
load new_labels.mat

%% Train and test labels

m = size(all_images,1);
[rows, columns] = size(all_images);
sel = 0.20 ;
indices = randperm(m);

ValidationLabels = labels(indices(1:round(sel*rows)));
TrainLabels = labels(indices(round(sel*rows)+1:end));

%% Training and Validation Datasets

ValidationSet = all_images(indices(1:round(sel*rows)),:) ;
TrainingSet= all_images(indices(round(sel*rows)+1:end),:); 

%% PCA Transformation

N= 12;
[ATrain, YTrain, EigenValuesTrain] = PCA_transformation(TrainingSet, N);

%%
YValidation=ValidationSet*ATrain;

%% Validation Results

ModelTrain = fitcknn(YTrain,TrainLabels,'NumNeighbors',10,'Standardize',1, 'Distance','euclidean', ...
  'DistanceWeight', 'squaredinverse');

%% Prediction

YValidationPred = predict(ModelTrain,YValidation);

%% Plot confusion matrix

figure(2);
plotconfusion(ind2vec(ValidationLabels'),ind2vec(YValidationPred'));
fprintf('\nTraining Set Accuracy: %f\n', mean(double(YValidationPred == ValidationLabels)) * 100);